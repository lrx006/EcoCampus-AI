# 节能助手规则库（Netlify 精简版；完整版见项目根目录 app.py 中的 CHAT_REPLIES）
import random

CHAT_REPLIES = [
    (["你好", "嗨", "在吗", "帮助"], ["你好～我是节能小助手，可以问我空调怎么省电、关灯有啥好处、电池怎么回收，或去试试「知识闯关」「我的周报」～", "嗨！想问节能、环保、校园省电都可以，比如空调 26℃、关灯、电池回收、闯关、周报～"]),
    (["谢谢", "感谢"], ["不客气～一起为绿色校园加油！有问题随时问我。", "不用谢！多做节能小行动，你就是校园节能指挥官～"]),
    (["空调", "温度", "26", "制冷"], ["空调设定 26℃ 最省电又舒适，每调高 1℃ 约可省电 7%。夏天试试 26℃，既凉快又环保～", "推荐 26℃：舒适和节能的黄金温度，养成习惯后电费会明显下降。"]),
    (["关灯", "开灯", "照明", "自然光"], ["白天采光好时关掉靠窗的灯，用自然光既省电又护眼。离开教室记得关灯，人走灯灭。", "离开前花 3 秒检查一下灯和空调，就能避免一整天的浪费。"]),
    (["电池", "回收", "灯管", "有害垃圾"], ["废旧电池、废灯管要投到有害垃圾或指定回收点，避免重金属污染土壤和水源。", "电池、灯管属于有害垃圾，别混在普通垃圾里，找到回收点投递就是在保护地球。"]),
    (["闯关", "答题", "知识闯关"], ["去页面的「知识闯关」可以玩 10 关节能题目，答对还有环保值和小贴士哦～", "节能知识闯关在首页就能找到，闯完还有周报可生成。"]),
    (["周报", "报告", "评语"], ["在「我的节能周报」里点「生成我的节能周报」，会根据闯关得分生成鼓励评语～", "完成知识闯关后，到周报区块一键生成，会有专属评语和行动建议。"]),
    (["预测", "能耗", "仪表盘"], ["在「智能监控区」用时间、温度、是否节假日三个滑块可以实时预测校园能耗，下方还有仪表盘～", "首页智能监控区可模拟不同情景的能耗，试试「工作日」「夏夜」「节假日」预设。"]),
    (["节能", "环保", "省电", "怎么省"], ["节能从小事做起：关灯、26℃ 空调、回收电池、双面打印、走楼梯…每一点都在为地球加分。", "小行动大改变。今天就开始：离开关灯、空调 26℃、电池送回收点～"]),
]

CHAT_FALLBACKS = [
    "你可以问我：空调怎么省电？关灯有什么好处？电池怎么回收？也可以去试试「知识闯关」和「我的周报」～",
    "试试问我：空调、关灯、电池回收、闯关、周报…随便起个头我就接！",
]
CHAT_EMPTY = "发一句话给我吧～比如「空调怎么省电」或「电池怎么回收」～"
MAX_LEN = 500


def chat_reply(user_text: str) -> str:
    if not isinstance(user_text, str):
        return random.choice(CHAT_FALLBACKS)
    t = user_text.strip()
    if not t:
        return CHAT_EMPTY
    if len(t) > MAX_LEN:
        t = t[:MAX_LEN]
    t_lower = t.lower()
    for keywords, replies in CHAT_REPLIES:
        if any(kw in t_lower for kw in keywords):
            return random.choice(replies)
    return random.choice(CHAT_FALLBACKS)
