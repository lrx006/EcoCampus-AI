# 创意方案：基于 AI 的校园节能闯关助手

**EcoCampus AI · 校园节能指挥官**

> 智慧校园 · 绿色节能 · AI 赋能

---

## 一、作品框架设计

系统采用 **B/S 架构**：浏览器单页应用 + Flask 后端，数据流与功能模块关系如下。

### 1.1 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        用户浏览器 (单页应用)                               │
│  Bootstrap 5 + Chart.js + FontAwesome + 自定义 JS/CSS (Glassmorphism)   │
└─────────────────────────────────────────────────────────────────────────┘
                    │                    │                    │
                    ▼                    ▼                    ▼
        ┌───────────────┐    ┌───────────────┐    ┌───────────────┐
        │ 智能监控区     │    │ 节能知识闯关   │    │ 节能助手对话   │
        │ 滑块·仪表盘   │    │ 10关·翻转卡片  │    │ 规则匹配·气泡  │
        └───────┬───────┘    └───────┬───────┘    └───────┬───────┘
                │                    │                    │
                ▼                    ▼                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      Flask 后端 (Python)                                  │
│  /api/predict  │  /api/report  │  /api/chat                              │
└─────────────────────────────────────────────────────────────────────────┘
        │                    │                    │
        ▼                    ▼                    ▼
┌───────────────┐  ┌───────────────────┐  ┌───────────────┐
│ 能耗预测模型   │  │ 周报生成           │  │ 规则对话引擎   │
│ (scikit-learn  │  │ DeepSeek API(可选) │  │ 多意图·多回复  │
│  线性回归)     │  │ 或 本地预设评语    │  │ 无需 API Key   │
└───────────────┘  └───────────────────┘  └───────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ 模拟数据集 (pandas + numpy)：时间段、室外温度、是否节假日 → 功率        │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 数据与功能流向简述

| 阶段 | 内容 |
|------|------|
| **数据层** | 使用 `pandas` + `numpy` 生成校园能耗模拟数据集（时段、温度、节假日 → 功率），供模型训练。 |
| **AI 能耗分析** | `scikit-learn` 线性回归模型根据输入预测功率；超阈值时前端给出「建议关闭非必要设备」等提示。 |
| **节能知识闯关** | 10 关题目覆盖电池回收、光照调节、空调设定、待机能耗、低碳出行等，答对获环保值，错题有解析。 |
| **个性化节能周报** | 根据闯关得分生成评语：可选调用 **DeepSeek API** 生成战报式文案，或使用本地 25+ 条预设评语。 |
| **节能助手对话** | 纯规则匹配引擎，无需 API Key：用户提问（空调、关灯、回收、闯关、周报等），返回多条随机预设回复，以假乱真。 |

---

## 二、核心功能模块与技术实现

### 2.1 校园设备能耗监测与预测（Python 模拟）

**功能描述**：模拟校园在不同时段、室外温度、是否节假日下的能耗，并在前端以仪表盘与数值形式展示。

**技术实现**：

- 使用 **pandas** 生成模拟数据集：`hour`（0–24）、`temp`（室外温度）、`is_holiday`（0/1）、`power`（功率），带简单线性关系与噪声。
- 使用 **scikit-learn** 的 `LinearRegression` 训练模型，以 `hour`、`temp`、`is_holiday` 为特征预测 `power`。
- **Flask** 提供 `POST /api/predict`，接收 JSON 参数，返回预测功率；前端 **Chart.js** 半圆仪表盘实时展示，超阈值时显示红色警告与脉冲动画。
- 前端对滑块输入做 **200ms 防抖**，请求期间显示加载图标，避免重复请求与卡顿。

**AI 结合点**：  
线性回归模型作为「AI 能耗分析引擎」核心，用于预测放学后/不同情景下的设备功耗，并驱动「建议关闭非必要设备」等智能提示。

---

### 2.2 节能知识闯关游戏（前端 + 单页逻辑）

**功能描述**：10 关节能知识题目，答题过程以翻转卡片展示题目与解析，答对得环保值，闯关结束展示总分与庆祝特效。

**技术实现**：

- **题目与关卡**：电池回收站、光照调节师、空调指挥官、待机能耗、低碳出行、节约用水、纸张与打印、充电器习惯、楼梯与电梯、垃圾分类等 10 关，每题含选项与正误解析。
- **交互**：纯前端实现（无 Pygame），使用 **Bootstrap 5** 卡片 + 自定义翻转动画；答对显示环保值 +10 与鼓励语，答错显示知识点提示。
- **闯关完成**：展示总分（满分 100），触发 **canvas-confetti** 五彩纸屑庆祝；**localStorage** 保存并展示历史最佳得分。
- 左侧栏/今日数据区展示「闯关最佳」等统计，与 `stats.js` 联动。

**AI / 智能化结合点**：  
闯关内容与「AI 能耗分析」场景一致（空调、照明、回收等），学到的知识可直接对应到智能监控区的情景预设与日常节能行为；周报根据闯关得分生成，形成「学习 → 反馈」闭环。

---

### 2.3 个性化节能周报

**功能描述**：用户一键生成基于闯关得分的节能周报评语，支持 AI 生成或本地预设，弹窗展示。

**技术实现**：

- 前端请求 `POST /api/report`，Body 可选 `{ "score": 0–100 }`，后端返回 `{ "report": "文本", "score": number }`。
- **DeepSeek API（可选）**：若配置环境变量 `DEEPSEEK_API_KEY`，则调用 DeepSeek 生成战报式、带 Emoji 与行动指令的评语；超时或未配置时自动回退。
- **本地备用**：内置 25+ 条环保评语，随机返回，保证无 Key 时也可用。
- 周报内容使用 `white-space: pre-wrap` 排版，长文本自动换行、段落清晰。

**AI 结合点**：  
集成 **DeepSeek API** 实现个性化、口语化周报文案生成（可选）；未使用 API 时仍通过丰富预设实现「个性化」体验。

---

### 2.4 节能助手对话（规则引擎，无需 API Key）

**功能描述**：用户输入文字与「节能助手」对话，获得空调、关灯、回收、闯关、周报等主题的回复，无需注册或配置任何 API Key。

**技术实现**：

- **后端**：`POST /api/chat` 接收 `{ "message": "用户输入" }`，对输入做关键词匹配（多意图、多关键词），从对应回复列表中 **随机** 返回一条，实现「以假乱真」的对话感。
- **意图覆盖**：问候/感谢/再见、空调/温度、关灯/照明、电池/回收、能耗/预测、闯关、周报、成就/徽章、贴士、垃圾分类、用水、出行、打印、楼梯/电梯、充电/待机、教室/宿舍、冬天/夏天、为什么/有用吗、随便聊、通用节能/省电等；每类多条回复，避免机械重复。
- **前端**：对话区为毛玻璃风格，消息气泡区分用户/助手，支持 Enter 发送、加载态、防重复发送与发送后焦点回输入框。
- **无外部依赖**：全程本地规则匹配，不调用任何第三方对话 API，不涉及用户 API Key。

**AI 结合点**：  
以「规则 + 大量预设回复」模拟智能对话，在不使用大模型 API 的前提下，提供与校园节能场景高度契合的问答体验，可作为「轻量 AI 应用」的替代方案。

---

### 2.5 成就徽章与今日数据

**功能描述**：展示用户行为统计（今日预测次数、闯关最佳、周报生成次数、成就徽章数等），以及成就徽章解锁状态（首次预测、闯关达人、满分、周报生成、探索者、环保粉丝等）。

**技术实现**：

- 前端 **stats.js** 与各模块联动，更新今日数据与徽章解锁条件；成就区块使用卡片网格展示，已解锁/未解锁样式区分。
- 今日数据条五列等分布局（Flex），与左侧栏「今日」统计一致，数据来源于本地计数与 localStorage（如闯关最佳）。

---

### 2.6 界面与交互（Glassmorphism + 响应式）

**技术实现**：

- **Glassmorphism 风格**：毛玻璃卡片、渐变背景、轻量科技感网格，统一圆角与间距变量（如 `--radius-card`、`--space-section`）。
- **Bootstrap 5 + FontAwesome**：导航、栅格、按钮、图标；导航平滑滚动并随滚动高亮当前区块（首页、节能数据、知识闯关、周报、助手）。
- **节能小贴士**：首页标题下方轮播展示节能小知识（约 5 秒切换）；节能贴士网格展示多条固定贴士。
- **移动端适配**：控制台、闯关区、对话区在小屏下自适应，翻转卡片高度由内容撑开。

---

## 三、任务与工具支持

| 任务 | 工具支持 |
|------|----------|
| 设计校园能耗数据集 | Excel 概念设计 + Python **pandas** / **numpy** 生成模拟数据 |
| 开发 AI 能耗预测模块 | **scikit-learn**（LinearRegression）+ Flask 提供 REST API |
| 实现智能监控区与仪表盘 | **Chart.js** 半圆仪表盘 + 防抖、情景预设、最近预测（JavaScript） |
| 制作节能知识闯关 | 前端 **Bootstrap 5** + 自定义 JS（题目、翻转卡片、得分、**canvas-confetti**） |
| 实现个性化节能周报 | **Flask** + **DeepSeek API**（可选）+ 本地预设评语（25+ 条） |
| 实现节能助手对话 | 规则匹配引擎（Python）+ 多意图多回复库，**无需 API Key** |
| 成就与今日数据展示 | **stats.js** + localStorage + 响应式布局 |
| 界面与动效 | **CSS3**（Glassmorphism、动画、响应式）+ **FontAwesome** |
| 录制演示视频 | OBS 录屏 + 绿幕抠像（可选） |

---

## 四、核心代码示例（AI 能耗预测模型）

以下为能耗预测模型与数据准备的简化示例，对应 `model.py` 与 `app.py` 中的逻辑。

```python
# AI 能耗预测模型（简化版）
from sklearn.linear_model import LinearRegression
import pandas as pd
import numpy as np

# 模拟数据集：时间段、室外温度、是否节假日 → 设备功率
def _build_dataset(n_samples=500, seed=42):
    rng = np.random.default_rng(seed)
    hour = rng.integers(0, 25, size=n_samples)
    temp = rng.uniform(-5, 35, size=n_samples)
    is_holiday = rng.integers(0, 2, size=n_samples)
    power = 100 + 3*hour + 2*temp + 50*is_holiday + rng.normal(0, 15, size=n_samples)
    power = np.maximum(power, 20)
    return pd.DataFrame({"hour": hour, "temp": temp, "is_holiday": is_holiday, "power": power})

# 训练与预测
data = _build_dataset()
model = LinearRegression()
model.fit(data[["hour", "temp", "is_holiday"]], data["power"])

# 预测放学后 19 时、26℃ 时的功耗
pred = model.predict([[19, 26, 0]])[0]
print(f"预测功耗: {pred:.1f} kW → 建议关闭非必要设备!")
```

---

## 五、文档与仓库结构说明

- **README.md**：项目概述、功能特性、技术栈、安装运行、项目结构、API 简要说明。
- **程序详细说明.md**（本文档）：作品框架设计、核心功能模块、技术实现、任务与工具支持、代码示例，便于课程展示与比赛答辩。

---

**EcoCampus AI** — 让校园更绿，从一次预测与一次闯关开始。 🌍
